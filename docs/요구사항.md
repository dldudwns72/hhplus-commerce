# 기능 요구사항

1️⃣ **`주요`** **잔액 충전 / 조회 API**

- 결제에 사용될 금액을 충전하는 API 를 작성합니다.
- 사용자 식별자 및 충전할 금액을 받아 잔액을 충전합니다.
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.

2️⃣ **`기본` 상품 조회 API**

- 상품 정보 ( ID, 이름, 가격, 잔여수량 ) 을 조회하는 API 를 작성합니다.
- 조회시점의 상품별 잔여수량이 정확하면 좋습니다.

3️⃣ **`주요`** **주문 / 결제 API**

- 사용자 식별자와 (상품 ID, 수량) 목록을 입력받아 주문하고 결제를 수행하는 API 를 작성합니다.
- 결제는 기 충전된 잔액을 기반으로 수행하며 성공할 시 잔액을 차감해야 합니다.
- 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송해야 합니다. ( 데이터 플랫폼이 어플리케이션 `외부` 라는 가정만 지켜 작업해 주시면 됩니다 )


4️⃣ **`기본` 상위 상품 조회 API**

- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공하는 API 를 작성합니다.
- 통계 정보를 다루기 위한 기술적 고민을 충분히 해보도록 합니다.

## 도메인 별 기능 분석

1. 잔액 충전 및 조회
   1. 유저는 잔액을 충전 할 수 있다.
      1. 현재는 결제로 충전이 이루어지는 것이 아닌 요청된 포인트 값 기반 잔액 충전 진행
   2. 유저는 현재 잔액을 조회할 수 있다.
2. 상품 조회
   1. ID, 이름, 가격, 잔여수량 정보를 가진 상품을 조회한다.
   2. 상품별 잔여 수량이 정확해야한다.
   3. 관리자가 원하는 수량만큼 페이징처리 할 수 있다.
3. 상품 주문
   1. 유저는 상품 ID, 상품별 수량으로 주문을 할 수 있다.
   2. 상품 조회 시 재고가 남지 않았을 경우 예외를 발생시킨다
      1. 상품 재고의 정확성을 위해 비관적락을 사용
   3. 유저 잔액이 상품 금액보다 적을 경우 예외를 발생시킨다.
   4. 쿠폰을 이용하여 할인된 금액으로 상품을 구매할 수 있다.
      1. 쿠폰 사용 시 유저가 사용한 쿠폰은 사용된 쿠폰으로 업데이트 한다.
      2. 이미 사용된 쿠폰일 경우 예외가 발생한다.
   5. 주문 완료 시 상품의 개수가 차감된다.
   6. 주문 완료 시 유저의 잔액이 차감된다.
4. 결제
   1. 외부 플랫폼으로 부터 응답이 정상적으로 왔을 경우 true 응답
   2. 비정상적인 응답이 왔을 땐 비즈니스 예외 처리 진행
5. 인기 상품 조회
   1. 최근 3일간 주문정보를 통해 많이 팔린 상품 5개의 정보 조회한다.
6. 쿠폰
   1. 쿠폰은 유저가 사용할 수 있는 수량이 존재한다.
      1. 선착순 쿠폰 발급을 위한 쿠폰 수량 정확성을 위한 비관적 락 사용
    